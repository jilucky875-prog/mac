- name: üîê Inject Password & Force Start VNC
        run: |
          echo "Step 1: Injecting Password '123456'..."
          sudo python3 -c '
          import os
          key = bytes.fromhex("1734516E8BA8C5E2FF1C39567390ADCA")
          pwd = b"123456".ljust(8, b"\x00")[:8]
          obf = bytes(a ^ b for a, b in zip(pwd, key))
          with open("/Library/Preferences/com.apple.VNCSettings.txt", "wb") as f:
              f.write(obf)
          user_path = "/Users/runner/Library/Preferences/com.apple.VNCSettings.txt"
          with open(user_path, "wb") as f:
              f.write(obf)
          '
          
          echo "Step 2: Activating VNC Server (Fixed missing -activate)..."
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -configure -access -on -clientopts -setvnclegacy -vnclegacy yes -allowAccessFor -allUsers -privs -all -restart -agent
          
          echo "Step 3: Forcing macOS Screen Sharing Daemon..."
          sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.screensharing.plist || true
          
          echo "Setting up noVNC..."
          git clone https://github.com/novnc/noVNC.git
          git clone https://github.com/novnc/websockify noVNC/utils/websockify
          ./noVNC/utils/novnc_proxy --vnc localhost:5900 --listen 8080 &
